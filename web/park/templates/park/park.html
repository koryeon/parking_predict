{% extends 'base.html' %}
{% load static %}

{% block content %}
<style>
    .container {
    max-width: 420px;
    margin: 0 auto;  /* âœ… ìœ„ì•„ë˜ margin ì œê±° */
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 4px 24px rgba(30,41,59,0.09);
    padding: 0 28px;  /* âœ… ìœ„ì•„ë˜ padding ì œê±° */
    position: relative;

    min-height: calc(100vh - 100px);  /* ğŸ‘‰ í•„ìš”ì‹œ ìœ ì§€: í™”ë©´ ë†’ì´ ì±„ì›€ */
    display: flex;
    flex-direction: column;
    justify-content: center;
    }
    h1 {
        text-align: center;
        color: #1e293b;
        margin-bottom: 24px;
        font-size: 1.7rem;
        letter-spacing: 1px;
    }
    form label {
        display: block;
        margin: 16px 0 6px 0;
        color: #334155;
        font-weight: 500;
    }
    form input,
    form select {
        width: 94%;
        padding: 10px 12px;
        border: 1.5px solid #cbd5e1;
        border-radius: 5px;
        font-size: 1rem;
        margin-bottom: 10px;
        background: #f1f5f9;
        transition: border 0.2s;
    }
    form input:focus,
    form select:focus {
        border: 1.5px solid #38bdf8;
        outline: none;
        background: #e0f2fe;
    }
    .main-btn {
        width: 100%;
        background: linear-gradient(90deg, #38bdf8 0%, #0ea5e9 100%);
        color: #fff;
        border: none;
        padding: 13px;
        border-radius: 5px;
        font-size: 1.13rem;
        font-weight: bold;
        cursor: pointer;
        margin-top: 20px;
        box-shadow: 0 2px 8px rgba(30,41,59,0.07);
        transition: background 0.2s;
    }
    .main-btn:hover {
        background: linear-gradient(90deg, #0ea5e9 0%, #38bdf8 100%);
    }
    .save-btn {
        width: 100%;
        background: linear-gradient(90deg, #f59e42 0%, #fbbf24 100%);
        color: #fff;
        border: none;
        padding: 13px;
        border-radius: 5px;
        font-size: 1.13rem;
        font-weight: bold;
        cursor: pointer;
        margin-top: 24px;
        box-shadow: 0 2px 8px rgba(30,41,59,0.07);
        transition: background 0.2s;
        letter-spacing: 1px;
    }
    .save-btn:hover {
        background: linear-gradient(90deg, #fbbf24 0%, #f59e42 100%);
    }
    .result-section {
        background: linear-gradient(135deg, #e0f2fe 0%, #fff7ed 100%);
        border-radius: 12px;
        margin-top: 30px;
        padding: 24px 18px;
        text-align: center;
        color: #0f172a;
        box-shadow: 0 2px 12px rgba(30,41,59,0.07);
        animation: fadeIn 0.6s;
        border: 1.5px solid #bae6fd;
        position: relative;
    }
    .result-section h2 {
        color: #f59e42;
        margin-bottom: 14px;
        font-size: 1.25rem;
        letter-spacing: 1px;
    }
    .result-badge {
        display: inline-block;
        background: #38bdf8;
        color: #fff;
        font-weight: bold;
        border-radius: 16px;
        padding: 6px 18px;
        font-size: 1.08rem;
        margin-bottom: 12px;
        letter-spacing: 1px;
        box-shadow: 0 2px 8px rgba(30,41,59,0.06);
    }
    .result-list {
        list-style: none;
        padding: 0;
        margin: 0 0 10px 0;
    }
    .result-list li {
        font-size: 1.08rem;
        margin: 8px 0;
        color: #334155;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 7px;
    }
    .result-list li .icon {
        font-size: 1.1em;
    }
    .back-btn {
        position: absolute;
        top: 16px;
        left: 16px;
        background: none;
        border: none;
        color: #0f172a;
        font-size: 0.95rem;
        cursor: pointer;
        text-decoration: underline;
    }
    .back-btn:hover {
        color: #0ea5e9;
    }
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px);}
        to   { opacity: 1; transform: translateY(0);}
    }
    @media (max-width: 600px) {
        .container { padding: 16px 6px; }
    }
</style>

<div class="container">
    {% if not result_date %}
    <!-- ì…ë ¥ í¼ -->
    <h1>ë¶ˆë²•ì£¼ì •ì°¨ ì˜ˆì¸¡ ì„œë¹„ìŠ¤</h1>
    <form method="post">
        {% csrf_token %}
        <label>ë‚ ì§œ <span style="font-size:0.95em;color:#64748b;">(ì˜ˆ: 2025-07-07)</span></label>
        <input type="date" name="day" required>

        <label>ì‹œê°„ <span style="font-size:0.95em;color:#64748b;">(0~23ì‹œ)</span></label>
        <input type="number" name="hour" min="0" max="23" required>

        <label>ê¸°ì˜¨(â„ƒ)</label>
        <input type="number" step="0.1" name="temp" required>

        <label>ê°•ìˆ˜ëŸ‰(mm)</label>
        <input type="number" step="0.1" name="rain" required>

        <label>ì£¼ì†Œ</label>
        <input type="text" name="address" required placeholder="ì„œìš¸íŠ¹ë³„ì‹œ ê´‘ì§„êµ¬ xxë™">

        <button type="submit" name="predict" class="main-btn">ì˜ˆì¸¡í•˜ê¸°</button>
    </form>
    {% else %}
    <!-- ê²°ê³¼ ë³´ê¸° -->
    <form method="get">
        <button class="back-btn">â† ëŒì•„ê°€ê¸°</button>
    </form>

    <div class="result-section">
        <div class="result-badge">ì…ë ¥ê°’ ìš”ì•½</div>
        <ul class="result-list">
            <li><span class="icon">ğŸ“…</span> <b>ë‚ ì§œ:</b> {{ result_date }}</li>
            <li><span class="icon">â°</span> <b>ì‹œê°„:</b> {{ result_time }}ì‹œ</li>
            <li><span class="icon">ğŸŒ¡ï¸</span> <b>ê¸°ì˜¨:</b> {{ temp }}â„ƒ</li>
            <li><span class="icon">ğŸ’§</span> <b>ê°•ìˆ˜ëŸ‰:</b> {{ rain }}mm</li>
            <li><span class="icon">ğŸ“</span> <b>ì£¼ì†Œ:</b> {{ address }}</li>
            {% if coordinates %}
            <li><span class="icon">ğŸ—ºï¸</span> <b>ì¢Œí‘œ:</b> {{ coordinates.lat|floatformat:6 }}, {{ coordinates.lng|floatformat:6 }}</li>
            {% endif %}
        </ul>

        {% if ai_result %}
        <div class="result-badge" style="margin-top:18px;">ì˜ˆì¸¡ ê²°ê³¼</div>
        {% if ai_result.error %}
        <span style="color:red">API ì˜¤ë¥˜: {{ ai_result.error }}</span>
        {% else %}
        <ul class="result-list">
            <li><b>ìµœì¢… ê¸°ëŒ€ ë¯¼ì›:</b> {{ ai_result.expected_violations }}ê±´</li>
        </ul>

        <form method="post">
            {% csrf_token %}
            <input type="hidden" name="day" value="{{ result_date }}">
            <input type="hidden" name="hour" value="{{ result_time }}">
            <input type="hidden" name="temp" value="{{ temp }}">
            <input type="hidden" name="rain" value="{{ rain }}">
            <input type="hidden" name="address" value="{{ address }}">
            {% if coordinates %}
            <input type="hidden" name="latitude" value="{{ coordinates.lat }}">
            <input type="hidden" name="longitude" value="{{ coordinates.lng }}">
            {% endif %}
            <input type="hidden" name="probability_percent" value="{{ ai_result.probability_percent }}">
            <input type="hidden" name="raw_prediction" value="{{ ai_result.raw_prediction }}">
            <input type="hidden" name="expected_violations" value="{{ ai_result.expected_violations }}">
            <button type="submit" name="save" class="save-btn">ì €ì¥í•˜ê¸°</button>
        </form>
        {% endif %}
        {% endif %}
    </div>
    {% endif %}
</div>
{% endblock %}